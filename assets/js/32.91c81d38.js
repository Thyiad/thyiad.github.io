(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{487:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[s._v("前言")]),s._v(" "),e("p",[s._v("这两天想基于一个域名，不同path配置多个前端项目，被折磨了一下，搞定后记录一下")]),s._v(" "),e("h2",{attrs:{id:"需求"}},[s._v("需求")]),s._v(" "),e("p",[s._v("如上所述，想要用不同path来对应不同的前端项目，并且要支持history路由模式，文件夹结构长这样：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("v1\n    index.html\nv2\n    index.html\nv3\n    index.html\nindex.html\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"配置"}},[s._v("配置")]),s._v(" "),e("h3",{attrs:{id:"单个项目配置"}},[s._v("单个项目配置")]),s._v(" "),e("p",[s._v("常规的一个域名配置一个前端项目，我们都是这样配置的：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("location / {\n        root    /Users/taohongyong/Documents/data/websites/test;\n        index index.html index.htm\n        try_files $uri $uri/ /index.html;\n        add_header Access-Control-Allow-Origin *;\n        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';\n        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';\n        add_header Cache-control max-age=120;\n\n        if ($request_method = 'OPTIONS') {\n            return 204;\n        }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("ul",[e("li",[s._v("root 定义资源根路径")]),s._v(" "),e("li",[s._v("try_files 用来默认命中 index.html")])]),s._v(" "),e("p",[s._v("但我们要多个项目，就肯定要配置多个location了，最终有2种办法")]),s._v(" "),e("h3",{attrs:{id:"root-try-files-解法"}},[s._v("root+try_files 解法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("location /v1 {\n        root    /Users/taohongyong/Documents/data/websites/test;\n        index index.html index.htm;\n        try_files $uri $uri/ /v1/index.html;\n        add_header Access-Control-Allow-Origin *;\n        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';\n        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';\n        add_header Cache-control max-age=120;\n\n        set $IS_PATH \"\";\n        if ($request_uri ~* ^[^.]+$) {\n            set $IS_PATH Y;\n        }\n\n        if (!-e $request_filename) {\n            set $IS_PATH \"${IS_PATH}Y\";\n        }\n        \n        if ($IS_PATH = YY) {\n            rewrite ^ /v1/index.html last;\n        }\n\n        if ($request_method = 'OPTIONS') {\n            return 204;\n        }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("h3",{attrs:{id:"alias-解法"}},[s._v("alias 解法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("location /v1 {\n        alias    /Users/taohongyong/Documents/data/websites/test/v1;\n        index index.html index.htm;\n        try_files $uri $uri/ /v1/index.html;\n        add_header Access-Control-Allow-Origin *;\n        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';\n        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';\n        add_header Cache-control max-age=120;\n\n        set $IS_PATH \"\";\n        if ($request_uri ~* ^[^.]+$) {\n            set $IS_PATH Y;\n        }\n\n        if (!-e $request_filename) {\n            set $IS_PATH \"${IS_PATH}Y\";\n        }\n        \n        if ($IS_PATH = YY) {\n            rewrite ^ /v1/index.html last;\n        }\n\n        if ($request_method = 'OPTIONS') {\n            return 204;\n        }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("h3",{attrs:{id:"解释"}},[s._v("解释")]),s._v(" "),e("h4",{attrs:{id:"_1-root和alias的区分"}},[s._v("1. root和alias的区分")]),s._v(" "),e("p",[s._v("假设请求的路径是 /v1abc/a.css，root/alias设置为 /var/xyz")]),s._v(" "),e("ul",[e("li",[s._v("root在计算路径时，是/var/xyz/v1abc/a.css")]),s._v(" "),e("li",[s._v("alias在计算路径时，是alias(path-location)， /var/xyzabc/a.css")])]),s._v(" "),e("h3",{attrs:{id:"_2-后面3个if的作用"}},[s._v("2. 后面3个if的作用")]),s._v(" "),e("p",[s._v("如果不加3个if，那么假设访问了一个不存在的文件时，返回的仍然是index.html\n又因为nginx不支持并且的条件，所以只好写了3个if，通过变量来判断\n访问的path非文件(没有.号)+路径文件不存在时，返回index.html")]),s._v(" "),e("blockquote",[e("p",[s._v("如果是个存在的目录，此时会默认返回403")])])])}),[],!1,null,null,null);n.default=t.exports}}]);